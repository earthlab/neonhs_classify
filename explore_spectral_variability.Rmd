---
title: "Explore spectral variability"
author: "Victoria Scholl"
date: "6/25/2020"
output: html_document
---

```{r setup, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)
```


Explore spectral variability for individuals with multiple observations across years.

```{r read_data}
all_spectra <- read.csv(here::here("data","all_spectra.csv"))
```

```{r check_for_multiple_observations}
# see which uid's have multiple observations over time 
count_obs <- all_spectra %>%
  dplyr::group_by(individualID) %>% 
  filter(band_idx == "band1") %>%
  tally() 

table(count_obs$n)
```

Most individualIDs have just one spectrum, while others have two or three in the data set. 

```{r}
all_spectra %>%
  distinct(individualID, spectraID) %>%
  count(individualID) %>%
  arrange(-n)
```

```{r plot_multiple_obs_per_indvdlID}
current_indvdlID <- "NEON.PLA.D03.JERC.02220"
current_indvdlID <- "NEON.PLA.D03.OSBS.02053"

# list which dates have data for the current individual ID 
all_spectra %>%
  filter(individualID %in% current_indvdlID) %>%
  group_by(spectraID) %>% 
  tally()

# plot multiple spectra
all_spectra %>%
  filter(individualID %in% current_indvdlID) %>% 
  ggplot(aes(wavelength_nm, ifelse(mask, NA, reflectance), group = year,
             color = year)) + 
  facet_wrap(~year) + 
  geom_path() + 
  theme_bw() + 
  theme(legend.position = "none") + 
  labs(x = '\n Wavelength (nm)',
       y = 'Reflectance \n',
       color = "Date",
       title = paste0("Multiple observations for ", current_indvdlID))
```

additional unique identifier idvdlID + date? 
why are there multiple identical spectra for indvdlID, same date
